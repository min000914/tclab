
# PID -> Offline RL(IQL) -> Online RL(IQL)

RLì´ ì‹¤ì œ ì œì–´ í™˜ê²½ì—ì„œë„ ìž˜ ë™ìž‘í•˜ëŠ”ì§€ í™•ì¸í•˜ê³ ìž í•©ë‹ˆë‹¤.

ì‹¤ì œ í™˜ê²½ê³¼ ìƒí˜¸ìž‘ìš©í•˜ë©° Online RLì„ ì§„í–‰í•˜ê¸°ì—ëŠ” ì½”ìŠ¤íŠ¸(ì‹œê°„)ì†Œëª¨ê°€ í½ë‹ˆë‹¤.â€‹

ì „í†µì ì¸ ì œì–´ ë°©ì‹(PID)ì„ íë£¨í”„ ì œì–´ì˜ ì œì–´ìš”ì†Œë¡œ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤. â€‹

ìˆ˜ì§‘í•œ ë°ì´í„°ë¥¼ ì´ìš©í•˜ì—¬ Offline pre-trainì„ ì§„í–‰â€‹í•©ë‹ˆë‹¤.

í™˜ê²½ê³¼ ìƒí˜¸ìž‘ìš©í•˜ë©° ì ì€ ë°ì´í„°ë¡œ Online Tuningì„ ì§„í–‰í•©ë‹ˆë‹¤.

ì‹¤í—˜ í™˜ê²½ì€ TCLabì„ ê¸°ë°˜ìœ¼ë¡œ ì‹¤í—˜ì„ ì§„í–‰í•©ë‹ˆë‹¤.â€‹

PIDì™€ RL ëª¨ë¸ì˜ ê²°ê³¼ë¥¼ ë¹„êµí•©ë‹ˆë‹¤.

# ê°œìš”
1. ì‹¤ì œ TCLab í‚¤íŠ¸ ìƒì—ì„œ Tspë¥¼ ì ì ˆížˆ ì„¤ì •í•˜ê³ , PID ì œì–´ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ìˆ˜ì§‘â€‹

2. í•´ë‹¹ ë°ì´í„°ë¥¼ í†µí•´ Offline IQLì„ ì§„í–‰

3. ì‹œë®¬ë ˆì´í„°ë¥¼ í™œìš©í•˜ì—¬ ì„±ëŠ¥ì´ í–¥ìƒë˜ëŠ” Online IQLì— ëŒ€í•œ ë‹¤ì–‘í•œ ë°©ë²•ë¡ ì„ ì‹¤í—˜â€‹

4. ì°¾ì€ ë°©ë²•ë¡ ì„ í‚¤íŠ¸ì— ì ìš©í•˜ì—¬ Online IQLì„ ì‹œí–‰â€‹

5. í‚¤íŠ¸ì—ì„œ ìµœì¢… í‰ê°€ë¥¼ ì§„í–‰í•˜ì—¬ ì„±ëŠ¥ì„ ì¸¡ì •

# TCLab (Temperature Control Lab)

- ê³µì‹ ì‚¬ì´íŠ¸: [APMonitor Arduino Temperature Control](https://apmonitor.com/pdc/index.php/Main/ArduinoTemperatureControl)

TCLabì€ **2ê°œì˜ ížˆí„°**ì™€ **2ê°œì˜ ì˜¨ë„ ì„¼ì„œ**ë¡œ êµ¬ì„±ë˜ì–´, ì‹¤ì œ **ì—´ ì œì–´ ì‹œìŠ¤í…œì„ ì†Œí˜• ì‹¤í—˜ì‹¤ í™˜ê²½**ì—ì„œ ëª¨ì‚¬í•  ìˆ˜ ìžˆëŠ” ìž¥ë¹„ìž…ë‹ˆë‹¤.  
ëª©í‘œëŠ” **ížˆí„° ì¶œë ¥ì„ ì¡°ì ˆí•˜ì—¬ ì›í•˜ëŠ” ì˜¨ë„ë¥¼ ë”°ë¼ê°€ëŠ” ê²ƒ**ì´ë©°, ížˆí„° ì¶œë ¥ì€ **0~100%ì˜ ì‹¤ìˆ˜**ë¡œ ì¡°ì ˆ ê°€ëŠ¥í•©ë‹ˆë‹¤.  

> â„ï¸ ëƒ‰ê° ì‹œìŠ¤í…œì€ ë‚´ìž¥ë˜ì–´ ìžˆì§€ ì•Šìœ¼ë©°, **ìžì—° ëƒ‰ê°(ì™¸ë¶€ ì˜¨ë„)**ì— ì˜ì¡´í•©ë‹ˆë‹¤.


---

#  ì‹¤í—˜ ìˆœì„œ

## 1. Arduino & TCLab í™˜ê²½ ì„¤ì •

- ì•„ë‘ì´ë…¸ ì—°ê²° ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ëŠ” ë‹¤ìŒ ê³µì‹ ê¹ƒí—ˆë¸Œë¥¼ ì°¸ê³ í•˜ì„¸ìš”:  
  ðŸ‘‰ [Getting Started with TCLab](https://github.com/APMonitor/arduino/blob/master/gettingStarted.md)

---

## 2. PID & MPC Control ë°ì´í„° ìˆ˜ì§‘

### 2 - 1 PID

ê²½ë¡œ: `data_collect/PID_control/PID_data_collect.ipynb`

ë‹¤ìŒ 4ë‹¨ê³„ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³  ëª¨ë¸ì„ ì¶”ì •í•©ë‹ˆë‹¤.

---

#### ðŸ“Œ Step 1. ì§€ì—° ì‹œìŠ¤í…œ(FOPDT) ëª¨ë¸ì„ ìœ„í•œ ë°ì´í„° ìˆ˜ì§‘

FOPDT ëª¨ë¸ì€ í˜„ì‹¤ì˜ ë§Žì€ ë™ì  ì‹œìŠ¤í…œì„ ê°„ë‹¨í•˜ê³  íš¨ê³¼ì ìœ¼ë¡œ ê·¼ì‚¬í•˜ëŠ” ë° ì‚¬ìš©â€‹

PID ê³„ìˆ˜ë¥¼ ì¸¡ì •í•˜ê¸° ìœ„í•˜ì—¬ ì œì–´ ëŒ€ìƒì˜ ëª¨ë¸ ì •ë³´ê°€ í•„ìš”â€‹

ìˆ˜ì§‘ëœ ì‹œê³„ì—´ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‹œìŠ¤í…œì„ FOPDTëª¨ë¸ ê·¼ì‚¬â€‹í•˜ê¸° ìœ„í•˜ì—¬ Heater Q1, Q2ì— ëŒ€í•´ ì—¬ëŸ¬ êµ¬ê°„ì˜ ìŠ¤í… ìž…ë ¥ì„ ì£¼ìž…í•˜ì—¬ ë°ì´í„° ìˆ˜ì§‘â€‹


- **ê²°ê³¼**: `data.csv` (Q1/Q2 ìž…ë ¥, T1/T2 ì¶œë ¥)

---

#### ðŸ“Œ Step 2. FOPDT ëª¨ë¸ íŒŒë¼ë¯¸í„° ì¶”ì •
ìˆ˜ì§‘ëœ ì‹œê³„ì—´ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‹œìŠ¤í…œì„ FOPDTëª¨ë¸ ê·¼ì‚¬â€‹

    ð‘¦(ð‘¡): ì‹œìŠ¤í…œ ì¶œë ¥â€‹

    ð‘¢(ð‘¡): ìž…ë ¥ (ì˜ˆ: ë°¸ë¸Œ ê°œë„, ížˆí„° ì „ë ¥ ë“±)â€‹

    Kpâ€‹ : í”„ë¡œì„¸ìŠ¤ ì´ë“ (ìž…ë ¥ì˜ ë³€í™”ê°€ ì¶œë ¥ì— ë¯¸ì¹˜ëŠ” ì˜í–¥)â€‹

    ðœð‘ : ì‹œê°„ ìƒìˆ˜ (ì‹œìŠ¤í…œì´ ì–¼ë§ˆë‚˜ ë¹ ë¥´ê²Œ ë°˜ì‘í•˜ëŠ”ì§€)â€‹

    ðœƒð‘â€‹ : ì§€ì—° ì‹œê°„ (ìž…ë ¥ì´ ë³€í•  ë•Œ ì¶œë ¥ì— ì˜í–¥ê¹Œì§€ì˜ ì§€ì—° ì‹œê°„)
- **ì¶”ì • ê¸°ë²•**: `scipy.optimize.minimize` + ìˆ˜ì¹˜ ì ë¶„ (`odeint`)  
- **ê²°ê³¼**: ëª¨ë¸ íŒŒë¼ë¯¸í„° â†’ `fopdt.txt` ì €ìž¥

    ![alt text](img/image-2.png)
---

#### ðŸ“Œ Step 3. PID íŒŒë¼ë¯¸í„° ì¶”ì •

- **íŠœë‹ ë°©ì‹**:  
  - ITAE ê¸°ë°˜ PI íŠœë‹  
  - IMC ê¸°ë°˜ PID íŠœë‹  
- **ê²°ê³¼**: `Kc`, `tauI`, `tauD`, `Kff` ë„ì¶œ  
- **ì‹œë®¬ë ˆì´ì…˜ í™•ì¸**:  
  - ìŠ¬ë¼ì´ë” ì¸í„°íŽ˜ì´ìŠ¤(`ipywidgets`)ë¡œ ì‹¤ì‹œê°„ íŠœë‹ ì‹¤í—˜  
  - ëª¨ë¸ ê¸°ë°˜ ì˜¨ë„ ì‘ë‹µ í™•ì¸ ê°€ëŠ¥

---

#### ðŸ“Œ Step 4. PID ì œì–´ ê¸°ë°˜ ê°•í™”í•™ìŠµ ë°ì´í„° ìˆ˜ì§‘

- **ì‹¤ì œ ê¸°ê¸° ì ìš©**:  
  - íŠœë‹ëœ PIDë¡œ ížˆí„° ì œì–´  
  - ë‹¤ì–‘í•œ ëª©í‘œ ì˜¨ë„(TSP1, TSP2) ì‹œë‚˜ë¦¬ì˜¤ ì ìš©

  ---

### 2 - 2. Model Predictive Control (MPC) ë°©ì‹

**MPC** ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬ ì˜¨ë„ë¥¼ ì œì–´í•©ë‹ˆë‹¤.  
MPCëŠ” **ëª¨ë¸ ê¸°ë°˜ì˜ ìµœì í™” ì œì–´ê¸°**ë¡œ, í˜„ìž¬ ìƒíƒœì—ì„œ **ë¯¸ëž˜ë¥¼ ì˜ˆì¸¡í•˜ê³ , ìµœì ì˜ ì œì–´ ìž…ë ¥ì„ ê³„ì‚°**í•˜ëŠ” ê²ƒì´ í•µì‹¬ìž…ë‹ˆë‹¤.

ê²½ë¡œ: `data_collect/MPC_control/MPC_data_collect.py`

#### ðŸ”§ ìž‘ë™ ë°©ì‹ ìš”ì•½

1. **í˜„ìž¬ ì˜¨ë„ ì¸¡ì •**
   - ì„¼ì„œë¡œë¶€í„° `T1`, `T2`ë¥¼ ì½ì–´ í˜„ìž¬ ìƒíƒœë¥¼ íŒŒì•…í•©ë‹ˆë‹¤.

2. **ëª©í‘œ ì˜¨ë„ ì „ë‹¬**
   - `TSP1`, `TSP2`ë¥¼ deadband(Â±0.1â„ƒ)ë¥¼ í¬í•¨í•˜ì—¬ APMonitorì— ì „ë‹¬í•©ë‹ˆë‹¤.

3. **ë¯¸ëž˜ ì˜ˆì¸¡ ë° ìµœì í™” ìˆ˜í–‰**
   - ì„œë²„ì—ì„œëŠ” ì‹œìŠ¤í…œ ëª¨ë¸(FOPDT ë“±)ì„ ì‚¬ìš©í•˜ì—¬ í–¥í›„ ì˜¨ë„ ë³€í™” ì˜ˆì¸¡
   - ë¯¸ëž˜ ì¼ì • ì‹œê°„ ë™ì•ˆì˜ ì˜¨ë„ê°€ ëª©í‘œì— ê·¼ì ‘í•˜ë„ë¡ ìµœì ì˜ ížˆí„° ì¶œë ¥(Q1, Q2)ì„ ê³„ì‚°í•©ë‹ˆë‹¤.

4. **ížˆí„° ì œì–´**
   - ê³„ì‚°ëœ Q1, Q2ë¥¼ ì‹¤ì œ ížˆí„°ì— ì¶œë ¥í•˜ì—¬ ì˜¨ë„ë¥¼ ì œì–´í•©ë‹ˆë‹¤.

> âœ… ì´ ìµœì í™”ëŠ” `APMonitor` ì„œë²„ì—ì„œ ë§¤ ì œì–´ ì£¼ê¸°ë§ˆë‹¤ ì‹¤ì‹œê°„ìœ¼ë¡œ ìˆ˜í–‰ë©ë‹ˆë‹¤.

---

#### ì œì–´ ì›ë¦¬ (MPCì˜ í•µì‹¬)

MPCëŠ” ë‹¤ìŒ ìµœì í™” ë¬¸ì œë¥¼ ë°˜ë³µì ìœ¼ë¡œ í’‰ë‹ˆë‹¤:

minimize over Q1, Q2:
    sum_{k=0}^{N} [ (T1_k - TSP1_k)^2 + (T2_k - TSP2_k)^2 + penalty terms ]

---

#### êµ¬ì„± íŒŒì¼ ë° ì„¤ì • ì •ë³´

- **ëª¨ë¸ íŒŒì¼**: `MPC_control/control.apm`  
- **ë°ì´í„° íŒŒì¼**: `MPC_control/control.csv`


---



### 2 - 3. Model Predictive Control (MPC) ë°©ì‹

ê²½ë¡œ: `data_collect/pid_mpc_data_collect.py`

PIDì™€ MPC ë°ì´í„°ë¥¼ ë™ì‹œì— ìˆ˜ì§‘í•©ë‹ˆë‹¤.

**ë‹¨, PID ë°ì´í„° ìˆ˜ì§‘ì„ ìœ„í•´ì„œ ì•žì„  2-1 ë‹¨ê³„ë¥¼ ê±°ì³ PIDíŒŒë¼ë¯¸í„°ë¥¼ êµ¬í•´ë†“ì•„í– í•©ë‹ˆë‹¤.**

- **ìˆ˜ì§‘ ë°ì´í„°**:  
  - ìƒíƒœ: ì˜¨ë„(T1, T2)  
  - í–‰ë™: ížˆí„° ì¶œë ¥(Q1, Q2)  
  - ëª©í‘œ: TSP1, TSP2  
  - ë³´ìƒ ì§€í‘œ: IAE ë“±  
  - ì €ìž¥ í˜•ì‹: CSV (`PID_episode_*.csv`)

- ê° ì—í”¼ì†Œë“œ ê²°ê³¼ëŠ” ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì €ìž¥ë©ë‹ˆë‹¤:
  - **CSV**: 
  
        /data/PID_MPC/PID/csv/PID_episode_*.csv
        /data/PID_MPC/MPC/csv/MPC_episode_*.csv

  - **ê·¸ëž˜í”„(PNG)**:

        /data/PID_MPC/PID/csv/PID_episode_*.png
        /data/PID_MPC/MPC/csv/MPC_episode_*.png


## 3. Offline Reinforcement(IQL)

ë‹¤ìŒì˜ ê¹ƒí—ˆë¸Œë¥¼ ì°¸ì¡°í•˜ì—¬ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤. https://github.com/gwthomas/IQL-PyTorch

PID, MPCë¡œ ìˆ˜ì§‘ëœ ë°ì´í„°ë¥¼ í†µí•´ IQLì„ Offline í›ˆë ¨ì‹œí‚µë‹ˆë‹¤.

ê²½ë¡œ: `/make_offline_data.ipynb`

ë‹¤ìŒ ë…¸íŠ¸ë¶ì„ ì‹¤í–‰ì‹œì¼œ offline í›ˆë ¨ì— ì‚¬ìš©ë  ë°ì´í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
ìžì„¸í•œ ì‹¤í—˜ ì •ë¦¬ì™€ ì½”ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

### ì‹¤í—˜ 1
- ìƒíƒœ: T1, T2, TSP1, TSP2 
- ì•¡ì…˜: Q1, Q2
- ë³´ìƒ: ëª©í‘œì˜¨ë„ - ì¸¡ì •ì˜¨ë„

### ì‹¤í—˜ 2
- ìƒíƒœ: T1, T2, TSP1, TSP2 
- ì•¡ì…˜: Q1, Q2
- ë³´ìƒ: ëª©í‘œì˜¨ë„(t+1) - ì¸¡ì •ì˜¨ë„(t+1)



### ì‹¤í—˜ 3

- ìƒíƒœ: T1, T2, TSP1, TSP2 
- ì•¡ì…˜: Q1, Q2

- ë³´ìƒ:  PBRS(Potential-Based Reward Shaping) ì ìš© 

  -> Î¦(t) = -â€–T_t - TSP_tâ€–

  -> rt=0 //ê°œì„ ì •ë„ë§Œì´ ë³´ìƒì˜ ì²™ë„ê°€ ë¨.

  -> reward_t = rt + Î³ * Î¦(t+1) - Î¦(t) 
